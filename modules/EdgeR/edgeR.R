
library(limma)
library(edgeR)


x<-read.delim('user-files/2ec3c654522c5b7102ecb077b570e919-counts.csv',skip=0, sep=",", check.names=FALSE)
counts <- x[,c('81062-Q','81135-Q','81149-Q','AF93-Q','80054-Q','81030-Q','80150-Q','81008-Q','81062-V','81135-V','81149-V','AF93-V','80054-V','81030-V','81050-V','81008-V','80054-Q','81030-Q','80150-Q','81008-Q','81062-Q','81135-Q','81149-Q','AF93-Q','80054-V','81030-V','81050-V','81008-V','81062-V','81135-V','81149-V','AF93-V','81062-Q','81135-Q','81149-Q','AF93-Q','81062-V','81135-V','81149-V','AF93-V','80054-Q','81030-Q','80150-Q','81008-Q','80054-V','81030-V','81050-V','81008-V')]
keep <- apply(counts, 1, max) >= 1
x <- x[keep,]
counts <- counts[keep,]
design <- matrix(data=c(1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1), nrow=48, ncol=8, dimnames = list(c(), c('RSTR_Q','CTRL_Q','RSTR_V','CTRL_V','GROUP_Q','GROUP_V','RSTR','CTRL')))


nf <- calcNormFactors(counts)
y<-voom(counts, design, plot=FALSE,lib.size=colSums(counts)*nf)

cont.matrix <- matrix(data=c(-1,1,0,0,0,0,0,0), nrow=8, ncol=1, dimnames = list(c(), c('CTRL_Q')))

fit <- lmFit(y,design)
fit2 <- contrasts.fit(fit, cont.matrix)
fit2 <- eBayes(fit2)

out <- topTable(fit2, n=Inf, sort.by='none')

out2 <- cbind(fit2$coef,
              out[, c('adj.P.Val','AveExpr')],
              x[, c('geneSymbol','gene long name','81062-Q','81135-Q','81149-Q','AF93-Q','80054-Q','81030-Q','80150-Q','81008-Q','81062-V','81135-V','81149-V','AF93-V','80054-V','81030-V','81050-V','81008-V','80054-Q','81030-Q','80150-Q','81008-Q','81062-Q','81135-Q','81149-Q','AF93-Q','80054-V','81030-V','81050-V','81008-V','81062-V','81135-V','81149-V','AF93-V','81062-Q','81135-Q','81149-Q','AF93-Q','81062-V','81135-V','81149-V','AF93-V','80054-Q','81030-Q','80150-Q','81008-Q','80054-V','81030-V','81050-V','81008-V','EC')] )

write.csv(out2, file="out-file.csv", row.names=FALSE,na='')

# ------------------------------------------------------------
# VERSIONS


library(limma)
library(edgeR)


sessionInfo()
R version 3.1.2 (2014-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
[1] C

attached base packages:
[1] methods   stats     graphics  grDevices utils     datasets  base     

other attached packages:
[1] edgeR_3.8.0  limma_3.22.0

